
use crate::prelude::*;

#[derive(Bundle, Debug)]
pub struct UiTextExt {
    pub text: Text,
    pub text_font: TextFont,
}

impl UiTextExt {
    pub fn new(string: &str, size: usize, theme: &Theme) -> UiTextExt {
        UiTextExt {
            text: Text::new(string),
            text_font: TextFont {
                font: theme.default_font(),
                font_size: size as f32,
                ..default()
            },
        }
    }
}
pub type UiTextBundle = UiTextExt;

pub fn ansi_to_sections(
    ansi: &str,
    theme: &Theme,
    default_color: Color,
    font_size: f32,
    font: &Handle<Font>,
) -> Vec<(Text, TextFont, TextColor)> {
    let mut section_list = vec![];
    for block in ansi_str::get_blocks(ansi) {
        let color = match block.style().foreground() {
            Some(c) => match c {
                ansi_str::Color::Black => theme.color("black"),
                ansi_str::Color::BrightBlack => theme.color("black"),
                ansi_str::Color::Red => theme.color("red"),
                ansi_str::Color::BrightRed => theme.color("red"),
                ansi_str::Color::Green => theme.color("green"),
                ansi_str::Color::BrightGreen => theme.color("green"),
                ansi_str::Color::Yellow => theme.color("yellow"),
                ansi_str::Color::BrightYellow => theme.color("yellow"),
                ansi_str::Color::Blue => theme.color("blue"),
                ansi_str::Color::BrightBlue => theme.color("blue"),
                ansi_str::Color::Purple => theme.color("purple"),
                ansi_str::Color::BrightPurple => theme.color("purple"),
                ansi_str::Color::Magenta => theme.color("magenta"),
                ansi_str::Color::BrightMagenta => theme.color("magenta"),
                ansi_str::Color::Cyan => theme.color("cyan"),
                ansi_str::Color::BrightCyan => theme.color("cyan"),
                ansi_str::Color::White => theme.color("white"),
                ansi_str::Color::BrightWhite => theme.color("white"),
                ansi_str::Color::Fixed(x) => match x {
                    016 => color!("#000000"),
                    017 => color!("#00005f"),
                    018 => color!("#000087"),
                    019 => color!("#0000af"),
                    020 => color!("#0000d7"),
                    021 => color!("#0000ff"),
                    022 => color!("#005f00"),
                    023 => color!("#005f5f"),
                    024 => color!("#005f87"),
                    025 => color!("#005faf"),
                    026 => color!("#005fd7"),
                    027 => color!("#005fff"),
                    028 => color!("#008700"),
                    029 => color!("#00875f"),
                    030 => color!("#008787"),
                    031 => color!("#0087af"),
                    032 => color!("#0087d7"),
                    033 => color!("#0087ff"),
                    034 => color!("#00af00"),
                    035 => color!("#00af5f"),
                    036 => color!("#00af87"),
                    037 => color!("#00afaf"),
                    038 => color!("#00afd7"),
                    039 => color!("#00afff"),
                    040 => color!("#00d700"),
                    041 => color!("#00d75f"),
                    042 => color!("#00d787"),
                    043 => color!("#00d7af"),
                    044 => color!("#00d7d7"),
                    045 => color!("#00d7ff"),
                    046 => color!("#00ff00"),
                    047 => color!("#00ff5f"),
                    048 => color!("#00ff87"),
                    049 => color!("#00ffaf"),
                    050 => color!("#00ffd7"),
                    051 => color!("#00ffff"),
                    082 => color!("#5fff00"),
                    083 => color!("#5fff5f"),
                    084 => color!("#5fff87"),
                    085 => color!("#5fffaf"),
                    086 => color!("#5fffd7"),
                    087 => color!("#5fffff"),
                    076 => color!("#5fd700"),
                    077 => color!("#5fd75f"),
                    078 => color!("#5fd787"),
                    079 => color!("#5fd7af"),
                    080 => color!("#5fd7d7"),
                    081 => color!("#5fd7ff"),
                    070 => color!("#5faf00"),
                    071 => color!("#5faf5f"),
                    072 => color!("#5faf87"),
                    073 => color!("#5fafaf"),
                    074 => color!("#5fafd7"),
                    075 => color!("#5fafff"),
                    064 => color!("#5f8700"),
                    065 => color!("#5f875f"),
                    066 => color!("#5f8787"),
                    067 => color!("#5f87af"),
                    068 => color!("#5f87d7"),
                    069 => color!("#5f87ff"),
                    058 => color!("#5f5f00"),
                    059 => color!("#5f5f5f"),
                    060 => color!("#5f5f87"),
                    061 => color!("#5f5faf"),
                    062 => color!("#5f5fd7"),
                    063 => color!("#5f5fff"),
                    052 => color!("#5f0000"),
                    053 => color!("#5f005f"),
                    054 => color!("#5f0087"),
                    055 => color!("#5f00af"),
                    056 => color!("#5f00d7"),
                    057 => color!("#5f00ff"),
                    093 => color!("#8700ff"),
                    092 => color!("#8700d7"),
                    091 => color!("#8700af"),
                    090 => color!("#870087"),
                    089 => color!("#87005f"),
                    088 => color!("#870000"),
                    099 => color!("#875fff"),
                    098 => color!("#875fd7"),
                    097 => color!("#875faf"),
                    096 => color!("#875f87"),
                    095 => color!("#875f5f"),
                    094 => color!("#875f00"),
                    105 => color!("#8787ff"),
                    104 => color!("#8787d7"),
                    103 => color!("#8787af"),
                    102 => color!("#878787"),
                    101 => color!("#87875f"),
                    100 => color!("#878700"),
                    111 => color!("#87afff"),
                    110 => color!("#87afd7"),
                    109 => color!("#87afaf"),
                    108 => color!("#87af87"),
                    107 => color!("#87af5f"),
                    106 => color!("#87af00"),
                    117 => color!("#87d7ff"),
                    116 => color!("#87d7d7"),
                    115 => color!("#87d7af"),
                    114 => color!("#87d787"),
                    113 => color!("#87d75f"),
                    112 => color!("#87d700"),
                    123 => color!("#87ffff"),
                    122 => color!("#87ffd7"),
                    121 => color!("#87ffaf"),
                    120 => color!("#87ff87"),
                    119 => color!("#87ff5f"),
                    118 => color!("#87ff00"),
                    159 => color!("#afffff"),
                    158 => color!("#afffd7"),
                    157 => color!("#afffaf"),
                    156 => color!("#afff87"),
                    155 => color!("#afff5f"),
                    154 => color!("#afff00"),
                    153 => color!("#afd7ff"),
                    152 => color!("#afd7d7"),
                    151 => color!("#afd7af"),
                    150 => color!("#afd787"),
                    149 => color!("#afd75f"),
                    148 => color!("#afd700"),
                    147 => color!("#afafff"),
                    146 => color!("#afafd7"),
                    145 => color!("#afafaf"),
                    144 => color!("#afaf87"),
                    143 => color!("#afaf5f"),
                    142 => color!("#afaf00"),
                    141 => color!("#af87ff"),
                    140 => color!("#af87d7"),
                    139 => color!("#af87af"),
                    138 => color!("#af8787"),
                    137 => color!("#af875f"),
                    136 => color!("#af8700"),
                    135 => color!("#af5fff"),
                    134 => color!("#af5fd7"),
                    133 => color!("#af5faf"),
                    132 => color!("#af5f87"),
                    131 => color!("#af5f5f"),
                    130 => color!("#af5f00"),
                    129 => color!("#af00ff"),
                    128 => color!("#af00d7"),
                    127 => color!("#af00af"),
                    126 => color!("#af0087"),
                    125 => color!("#af005f"),
                    124 => color!("#af0000"),
                    160 => color!("#d70000"),
                    161 => color!("#d7005f"),
                    162 => color!("#d70087"),
                    163 => color!("#d700af"),
                    164 => color!("#d700d7"),
                    165 => color!("#d700ff"),
                    166 => color!("#d75f00"),
                    167 => color!("#d75f5f"),
                    168 => color!("#d75f87"),
                    169 => color!("#d75faf"),
                    170 => color!("#d75fd7"),
                    171 => color!("#d75fff"),
                    172 => color!("#d78700"),
                    173 => color!("#d7875f"),
                    174 => color!("#d78787"),
                    175 => color!("#d787af"),
                    176 => color!("#d787d7"),
                    177 => color!("#d787ff"),
                    178 => color!("#dfaf00"),
                    179 => color!("#dfaf5f"),
                    180 => color!("#dfaf87"),
                    181 => color!("#dfafaf"),
                    182 => color!("#dfafdf"),
                    183 => color!("#dfafff"),
                    184 => color!("#dfdf00"),
                    185 => color!("#dfdf5f"),
                    186 => color!("#dfdf87"),
                    187 => color!("#dfdfaf"),
                    188 => color!("#dfdfdf"),
                    189 => color!("#dfdfff"),
                    190 => color!("#dfff00"),
                    191 => color!("#dfff5f"),
                    192 => color!("#dfff87"),
                    193 => color!("#dfffaf"),
                    194 => color!("#dfffdf"),
                    195 => color!("#dfffff"),
                    226 => color!("#ffff00"),
                    227 => color!("#ffff5f"),
                    228 => color!("#ffff87"),
                    229 => color!("#ffffaf"),
                    230 => color!("#ffffdf"),
                    231 => color!("#ffffff"),
                    220 => color!("#ffdf00"),
                    221 => color!("#ffdf5f"),
                    222 => color!("#ffdf87"),
                    223 => color!("#ffdfaf"),
                    224 => color!("#ffdfdf"),
                    225 => color!("#ffdfff"),
                    214 => color!("#ffaf00"),
                    215 => color!("#ffaf5f"),
                    216 => color!("#ffaf87"),
                    217 => color!("#ffafaf"),
                    218 => color!("#ffafdf"),
                    219 => color!("#ffafff"),
                    208 => color!("#ff8700"),
                    209 => color!("#ff875f"),
                    210 => color!("#ff8787"),
                    211 => color!("#ff87af"),
                    212 => color!("#ff87df"),
                    213 => color!("#ff87ff"),
                    202 => color!("#ff5f00"),
                    203 => color!("#ff5f5f"),
                    204 => color!("#ff5f87"),
                    205 => color!("#ff5faf"),
                    206 => color!("#ff5fdf"),
                    207 => color!("#ff5fff"),
                    196 => color!("#ff0000"),
                    197 => color!("#ff005f"),
                    198 => color!("#ff0087"),
                    199 => color!("#ff00af"),
                    200 => color!("#ff00df"),
                    201 => color!("#ff00ff"),

                    232 => color!("#080808"),
                    233 => color!("#121212"),
                    234 => color!("#1c1c1c"),
                    235 => color!("#262626"),
                    236 => color!("#303030"),
                    237 => color!("#3a3a3a"),
                    238 => color!("#444444"),
                    239 => color!("#4e4e4e"),
                    240 => color!("#585858"),
                    241 => color!("#626262"),
                    242 => color!("#6c6c6c"),
                    243 => color!("#767676"),
                    255 => color!("#eeeeee"),
                    254 => color!("#e4e4e4"),
                    253 => color!("#dadada"),
                    252 => color!("#d0d0d0"),
                    251 => color!("#c6c6c6"),
                    250 => color!("#bcbcbc"),
                    249 => color!("#b2b2b2"),
                    248 => color!("#a8a8a8"),
                    247 => color!("#9e9e9e"),
                    246 => color!("#949494"),
                    245 => color!("#8a8a8a"),
                    244 => color!("#808080"),

                    000 => color!("#000000"),
                    001 => color!("#800000"),
                    002 => color!("#008000"),
                    003 => color!("#808000"),
                    004 => color!("#000080"),
                    005 => color!("#800080"),
                    006 => color!("#008080"),
                    007 => color!("#c0c0c0"),
                    008 => color!("#808080"),
                    009 => color!("#ff0000"),
                    010 => color!("#00ff00"),
                    011 => color!("#ffff00"),
                    012 => color!("#0000ff"),
                    013 => color!("#ff00ff"),
                    014 => color!("#00ffff"),
                    015 => color!("#ffffff"),
                },
                ansi_str::Color::Rgb(r, g, b) => Color::rgb_u8(r, g, b),
            },
            None => default_color,
        };
        section_list.push((
            Text::new(block.text()),
            TextFont {
                font: font.clone(),
                font_size,
                ..default()
            },
            TextColor(color),
        ));
    }
    section_list
}
